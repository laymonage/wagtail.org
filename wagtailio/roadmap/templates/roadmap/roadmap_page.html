{% extends "patterns/base_page.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block content %}

    {% include "patterns/components/hero/hero.html" with value=page classes="hero--small-margin" %}

    <div class="grid milestones">
        <div class="milestones__border"></div>

        {% for milestone in milestones %}
            <section class="milestone" id="{{ milestone.display_title|slugify }}">

                <div class="milestone__header">
                    {% include "patterns/components/icon/icon.html" with icon="flag" classes="icon--relative" %}

                    <h3 class="heading-three milestone__heading">
                        <a class="milestone__heading-link" href="#{{ milestone.display_title|slugify }}">{{ milestone.display_title }}</a>
                        {% if milestone.display_subtitle %}
                            <span class="milestone__heading-subtitle">{{ milestone.display_subtitle }}</span>
                        {% endif %}
                    </h3>
                    {% if perms.roadmap.change_milestone %}
                        <a class="milestone__heading-link milestone__heading-link--edit" href="{{ milestone.get_admin_url }}">✏️</a>
                    {% endif %}
                </div>

                <div class="milestone__items grid">
                    {% for item in milestone.items.all %}
                        <article class="milestone-item">
                            <div>
                                <a class="milestone-item__external-link" href="{{ item.url }}" target="_blank" rel="noreferrer">
                                    <h4 class="milestone-item__heading teaser-intro">
                                        <span>
                                            {{ item.title }}
                                        </span>
                                        <svg class="icon" aria-hidden="true" viewBox="0 0 100 100">
                                            <use xlink:href="#arrow-up-right-from-square">
                                            </svg>
                                        </h4>
                                    </a>
                                    <div class="milestone-item__labels">
                                        {% for label in item.labels_list %}
                                            <span class="milestone-item__label">{{ label }}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% if item.needs_sponsorship or item.sponsorship_url %}
                                    {% pageurl page.sponsorship_page item.url as sponsor_url %}
                                    <a
                                        class="milestone-item__sponsor-label mini-meta"
                                        href="{% firstof item.sponsorship_url sponsor_url %}"
                                        {% if item.sponsorship_url or not page.sponsorship_page %}
                                            target="_blank" rel="noreferrer"
                                        {% endif %}
                                    >
                                        Sponsor this
                                        <svg aria-hidden="true" class="icon" fill="currentColor">
                                            <use xlink:href="#arrow"></use>
                                        </svg>
                                    </a>
                                {% endif %}
                            </article>
                    {% endfor %}
                </div>

            </section>
        {% endfor %}
    </div>

    <div class="grid milestones">
        <div class="milestones__fine-print fine-print">
            {{ page.fine_print|richtext  }}
        </div>
    </div>

    {% include_block page.body %}
{% endblock %}
